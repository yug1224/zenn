---
title: 'GitHubã§Starã‚’ä»˜ã‘ãŸã‚‰Blueskyã«æŠ•ç¨¿ã™ã‚‹'
emoji: 'ğŸŒˆ'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['atproto', 'bluesky', 'deno', 'github', 'githubactions']
published: true
published_at: 2023-07-06 10:33
publication_name: 'hrbrain'
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€‚å¤ä¼‘ã¿ã¯æ–°æ½Ÿã‹ã‚‰ãƒ•ã‚§ãƒªãƒ¼ã§åŒ—æµ·é“ã«è¡Œãäºˆå®šã‚’ç«‹ã¦ã¦ã„ã‚‹[@yug1224](https://twitter.com/yug1224)ã§ã™ã€‚

æœ€è¿‘ã¯Twitterã®çªç™ºçš„ãªä»•æ§˜å¤‰æ›´ã«ã‚ˆã‚Šã€Twitterä»¥å¤–ã®åˆ†æ•£å‹SNSã‚‚æ³¨ç›®ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¾ã—ãŸã­ã€‚è‡ªåˆ†ã‚‚ã¡ã‚‡ã†ã©[Bluesky](https://blueskyweb.xyz/)ã®æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã‚’ã„ãŸã ã„ãŸã®ã§ç™»éŒ²ã—ã¦éŠã‚“ã§ã„ã¾ã™ã€‚

ä»Šå›ã¯GitHubã§Starã‚’ä»˜ã‘ãŸã‚‰Blueskyã«æŠ•ç¨¿ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œã£ã¦ã¿ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ï¼

![é’ç©ºã¨ç™½ã„é›²](/images/62ed25e658410f/bluesky.jpg)

## Blueskyã¨ã¯ï¼ŸğŸ¤”

ã¾ãšãã‚‚ãã‚‚[Bluesky](https://blueskyweb.xyz/)ã¨ã¯ä½•ã‹ï¼Ÿ

Blueskyã¨ã¯Twitterã®å‰µæ¥­è€…ã§ã‚ã‚‹ã‚¸ãƒ£ãƒƒã‚¯ãƒ»ãƒ‰ãƒ¼ã‚·ãƒ¼æ°ãŒæ”¯æ´ã™ã‚‹åˆ†æ•£å‹SNSã§ã‚ã‚Šã€ç¾åœ¨ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¿ä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã­ã€‚

ä»Šã®Blueskyã¯ITç³»ã®äººãŒå¤šãã€2010å¹´å‰å¾Œã®Twitterã®ã‚ˆã†ãªé›°å›²æ°—ã‚‚ã‚ã‚Šã€å€‹äººçš„ã«ã¯å±…å¿ƒåœ°ã®è‰¯ã•ã‚’æ„Ÿã˜ã¦ã„ã¾ã™ï½—

ã–ã£ãã‚Šã¨çŸ¥ã‚‹ãªã‚‰ã‚®ã‚ºãƒ¢ãƒ¼ãƒ‰ã®è¨˜äº‹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚

https://www.gizmodo.jp/2023/07/bluesky-now.html

## Blueskyã«æŠ•ç¨¿ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãğŸ’»

Blueskyã¯[AT Protocol](https://atproto.com/)ã¨å‘¼ã°ã‚Œã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ã£ã¦æƒ…å ±ã®ã‚„ã‚Šå–ã‚Šã‚’è¡Œã„ã¾ã™ãŒã€ã™ã§ã«[atproto](https://github.com/bluesky-social/atproto/)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ã¾ãšã¯ã“ã‚Œã‚’ä½¿ã£ã¦Blueskyã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

https://github.com/bluesky-social/atproto/

```ts
import 'https://deno.land/std@0.193.0/dotenv/load.ts'
import AtprotoAPI from 'npm:@atproto/api'

// Blueskyã«æ¥ç¶š
const { BskyAgent, RichText } = AtprotoAPI
const service = 'https://bsky.social'
const agent = new BskyAgent({ service })
const identifier = Deno.env.get('BLUESKY_IDENTIFIER') || ''
const password = Deno.env.get('BLUESKY_PASSWORD') || ''
await agent.login({ identifier, password })

// Blueskyã«æŠ•ç¨¿
const postObj = {
  $type: 'app.bsky.feed.post',
  text: 'Hello, AT Protocol!',
}
const result = await agent.post(postObj)
console.log(result)
```

![Blueskyã«ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹æ§˜å­](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/106236/b64482f9-444c-3e84-9faa-76634d8aaba3.gif)

`agent.login()`ã‚’ã—ã¦ã‹ã‚‰`agent.post()`ã‚’ã™ã‚‹ã ã‘ï¼ç°¡å˜ã§ã™ã­ï¼

## ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’æŠ•ç¨¿ã«å«ã‚ã‚‹ğŸƒ

æ¬¡ã¯ä¸€æ°—ã«å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

Blueskyã§æŠ•ç¨¿ã«ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã¯ã€ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤ºã™ã‚‹æƒ…å ±ã‚’æŠ•ç¨¿ã«å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€OGPæƒ…å ±ã‚’äº‹å‰ã«å–å¾—ã—ã¾ã™ã€‚

GitHubãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªãƒ³ã‚¯ã®æœ«å°¾ã«`.atom`ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§è‡ªèº«ã®Activityã‚’RSSã¨ã—ã¦å–å¾—ã§ãã‚‹ã®ã§ã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦æƒ…å ±ã‚’é›†ã‚ã¦ã„ãã¾ã™ã€‚ä¾‹: [https://github.com/yug1224.atom](https://github.com/yug1224.atom)

```ts
import 'https://deno.land/std@0.193.0/dotenv/load.ts'
import { Image } from 'https://deno.land/x/imagescript@1.2.15/mod.ts'
import { parseFeed } from 'https://deno.land/x/rss@0.6.0/mod.ts'
import AtprotoAPI from 'npm:@atproto/api'
import ogs from 'npm:open-graph-scraper'

// rss feedã‹ã‚‰æœ€æ–°ã®ã‚¹ã‚¿ãƒ¼ã‚’ä»˜ã‘ãŸè¨˜äº‹ãƒªã‚¹ãƒˆã‚’å–å¾—
const getStarredItemList = async () => {
  const response = await fetch(Deno.env.get('RSS_URL') || '')
  const xml = await response.text()
  const feed = await parseFeed(xml)

  const foundList = feed.entries.reverse().filter((item) => {
    return (
      new Date(new Date(Deno.env.get('LAST_EXECUTION_TIME') || '')) <
        new Date(item.published) &&
      new RegExp('starred', 'g').test(item.title.value)
    )
  })
  return foundList
}
const starredItemList = await getStarredItemList()
console.log(starredItemList)

// å¯¾è±¡ãŒãªã‹ã£ãŸã‚‰çµ‚äº†
if (!starredItemList.length) {
  console.log('not found starred item')
  Deno.exit(0)
}

// Blueskyã«æ¥ç¶š
const { BskyAgent, RichText } = AtprotoAPI
const service = 'https://bsky.social'
const agent = new BskyAgent({ service })
const identifier = Deno.env.get('BLUESKY_IDENTIFIER') || ''
const password = Deno.env.get('BLUESKY_PASSWORD') || ''
await agent.login({ identifier, password })

// å–å¾—ã—ãŸè¨˜äº‹ãƒªã‚¹ãƒˆã‚’ãƒ«ãƒ¼ãƒ—å‡¦ç†
for await (const starredItem of starredItemList) {
  // æŠ•ç¨¿äºˆå®šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
  const text = `${starredItem.title.value}\n${starredItem.links[0].href}`

  const pattern =
    /https?:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#\u3000-\u30FE\u4E00-\u9FA0\uFF01-\uFFE3]+/g
  const [url] = text.match(pattern) || ['']

  // URLã‹ã‚‰OGPã®å–å¾—
  const getOgp = async (url: string) => {
    const { result } = await ogs({ url })

    const ogImage = result.ogImage?.at(0)
    const response = await fetch(ogImage?.url || '')
    const buffer = await response.arrayBuffer()

    const image = await Image.decode(buffer)
    const resizedImage = await image
      .resize(800, Image.RESIZE_AUTO)
      .encodeJPEG(80)

    return {
      url: ogImage?.url || '',
      type: ogImage?.type || '',
      description: result.ogDescription || '',
      title: result.ogTitle || '',
      image: resizedImage,
    }
  }
  const og = await getOgp(url)

  // ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const uploadedImage = await agent.uploadBlob(og.image, {
    encoding: 'image/jpeg',
  })

  // Blueskyã«æŠ•ç¨¿
  const rt = new RichText({ text })
  await rt.detectFacets(agent)
  console.log(rt.text, rt.facets)

  const postObj = {
    $type: 'app.bsky.feed.post',
    text: rt.text,
    facets: rt.facets,
    embed: {
      $type: 'app.bsky.embed.external',
      external: {
        uri: url,
        thumb: {
          $type: 'blob',
          ref: {
            $link: uploadedImage.data.blob.ref.toString(),
          },
          mimeType: uploadedImage.data.blob.mimeType,
          size: uploadedImage.data.blob.size,
        },
        title: og.title,
        description: og.description,
      },
    },
  }

  const result = await agent.post(postObj)
  console.log(result)
}
```

![GitHub Starã®æƒ…å ±ã‚’å–å¾—ã—ã€ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«æŠ•ç¨¿ã™ã‚‹](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/106236/2ad18dd9-0d2a-f3e5-a618-bac06e8dcfb6.gif)

OGPæƒ…å ±ã‚’å…ƒã«ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ã‚‚è¡¨ç¤ºã§ãã¾ã—ãŸï¼ç°¡å˜ã§ã™ã­ï¼

## GitHub Actionsã§å®šæœŸå®Ÿè¡Œã™ã‚‹â°

æœ€å¾Œã«GitHub Actionsã§å®šæœŸå®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

`BLUESKY_IDENTIFIER` `BLUESKY_PASSWORD`ã¯Blueskyã®Settingsã‹ã‚‰å–å¾—ã—ã¦ã€secretsã«ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚

```yaml
name: Star to Bluesky
on:
  schedule:
    # 5åˆ†ã”ã¨ã«å®Ÿè¡Œ
    - cron: '0/5 * * * *'
  workflow_dispatch:
jobs:
  star-to-bluesky:
    runs-on: ubuntu-latest
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: Checkout
        uses: actions/checkout@v4
      # å‰å›ã®å®Ÿè¡Œæ™‚åˆ»ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
      - name: Get Last Execution Time
        id: last-execution
        run: |
          url="https://api.github.com/repos/yug1224/star-to-bluesky/actions/workflows/star-to-bluesky.yml/runs?status=success&per_page=1"
          echo "LAST_EXECUTION_TIME=$(curl -fsSL "$url" | jq -r '.workflow_runs[0].updated_at')" >> $GITHUB_ENV
      # Denoã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Setup Deno
        uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x
      # Denoã®å®Ÿè¡Œ
      - name: Deno Run
        run: deno run --allow-read --allow-env --allow-net main.ts
        env:
          BLUESKY_IDENTIFIER: ${{secrets.BLUESKY_IDENTIFIER}}
          BLUESKY_PASSWORD: ${{secrets.BLUESKY_PASSWORD}}
          RSS_URL: ${{secrets.RSS_URL}}
```

![GitHub Actionsã®å®Ÿè¡Œçµæœ](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/106236/e1776848-e246-916d-ab79-a260396a6f14.png)

ã ã„ãŸã„5åˆ†ã”ã¨ã«å®šæœŸå®Ÿè¡Œã§ãã¾ã—ãŸï¼ç°¡å˜ã§ã™ã­ï¼

## æœ€å¾Œã«ğŸ‰

ä»Šå›ã¯GitHubã§Starã‚’ä»˜ã‘ãŸã‚‰Blueskyã«æŠ•ç¨¿ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸï¼

ä¸‹è¨˜ãƒªãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã‚‹ã®ã§ã€æ˜¯éå‹•ã‹ã—ã¦ã¿ã¦ãã ã•ã„ï¼ğŸ™Œ

https://github.com/yug1224/github-star-to-bluesky

Blueskyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ãƒªãƒ³ã‚¯ã‚‚è¼‰ã›ã¦ãŠãã¾ã™ã€‚ã‚‚ã—è‰¯ã‘ã‚Œã°ãƒ•ã‚©ãƒ­ãƒ¼ãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ‰

https://bsky.app/profile/yug1224.com

## å‚è€ƒè¨˜äº‹ğŸ“š

ä¸‹è¨˜è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

https://zenn.dev/kawarimidoll/articles/42efe3f1e59c13

https://zenn.dev/ryo_kawamata/articles/8d1966f6bb0a82

https://zenn.dev/hashrock/articles/dbd868e390d60f

https://qiita.com/kt3k/items/e22422ea8e481b99703a
